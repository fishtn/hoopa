{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"hoopa","text":""},{"location":"#_1","title":"\u7b80\u4ecb","text":"<p>hoopa \u662f\u4e00\u4e2a\u8f7b\u91cf\u3001\u5feb\u901f\u7684\u5f02\u6b65\u5206\u5e03\u5f0f\u722c\u866b\u6846\u67b6</p> <ul> <li>\u652f\u6301\u57fa\u4e8e\u5185\u5b58\u3001redis\u3001rabbitmq\u7684\u7b49\u4f18\u5148\u7ea7\u961f\u5217</li> <li>\u652f\u6301aiohttp\u3001 httpx\u3001requests\u7b49HTTP\u5e93</li> <li>\u652f\u6301\u65ad\u70b9\u7eed\u4f20</li> </ul> <p>\u517c\u5bb9\u540c\u6b65\u548c\u5f02\u6b65\u4ee3\u7801\uff0c\u4e0d\u4e60\u60ef\u5f02\u6b65\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528\u540c\u6b65\u5199\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u7684\u662f\u4e0d\u80fd\u5728\u5f02\u6b65\u65b9\u6cd5\u91cc\u9762\u8fdb\u884c\u963b\u585e\u7684\u64cd\u4f5c</p> <p>\u9879\u76ee\u8fd8\u5728\u5f00\u53d1\u6d4b\u8bd5\u4e2d\uff0c\u8bf7\u52ff\u7528\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u82e5\u53d1\u73b0\u95ee\u9898\uff0c\u6b22\u8fce\u63d0issue</p> <p>\u6587\u6863\u5730\u5740\uff1ahttps://fishtn.github.io/hoopa/</p>"},{"location":"#_2","title":"\u73af\u5883\u8981\u6c42\uff1a","text":"<ul> <li>Python 3.7.0+</li> <li>Works on Linux, Windows, macOS</li> </ul>"},{"location":"#_3","title":"\u5b89\u88c5","text":"<pre><code># For Linux &amp; Mac\npip install -U hoopa[uvloop]\n\n# For Windows\npip install -U hoopa\n</code></pre>"},{"location":"#_4","title":"\u5f00\u59cb","text":"<p>\u521b\u5efa\u722c\u866b</p> <pre><code>hoopa create -s first_spider\n</code></pre> <p>\u7136\u540e\u6dfb\u52a0url\uff1ahttp://httpbin.org/get</p> <pre><code>\nimport hoopa\n\n\nclass FirstSpider(hoopa.Spider):\n    name = \"first\"\n    start_urls = [\"http://httpbin.org/get\"]\n\n    def parse(self, request, response):\n        print(response)\n\n\nif __name__ == \"__main__\":\n    FirstSpider.start()\n\n</code></pre>"},{"location":"#todo","title":"todo","text":"<ul> <li>[ ] \u76d1\u63a7\u5e73\u53f0</li> <li>[ ] \u8fdc\u7a0b\u90e8\u7f72</li> <li>[ ] \u4efb\u52a1\u8c03\u5ea6</li> </ul>"},{"location":"#_5","title":"\u611f\u8c22","text":"<ul> <li>Tinepeas</li> <li>ruia</li> <li>feapder</li> <li>scrapy</li> <li>starlette</li> </ul>"},{"location":"Started/1.overview/","title":"\u6982\u89c8","text":"<p>\u722c\u866b\u7a0b\u5e8f\u53ef\u4ee5\u5f02\u6b65\u65b9\u6cd5\u5199\uff0c\u4e5f\u53ef\u4ee5\u7528\u540c\u6b65\u65b9\u6cd5\u5199 \u53ef\u4ee5\u5728\u540c\u6b65\u65b9\u6cd5\u91cc\u9762\u6267\u884c\u963b\u585e\u7684\u4efb\u52a1\uff0c\u4f46\u662f\u4e0d\u80fd\u5728\u5f02\u6b65\u65b9\u6cd5\u91cc\u9762\u6267\u884c\u963b\u585e\u7684\u4efb\u52a1\uff0c\u4e0d\u7136\u4f1a\u963b\u585e</p> <p>\u6570\u636e\u6d41\u5982\u4e0b\uff1a</p> <p></p> <p>\u6838\u5fc3\u662fspider\uff0c\u89e3\u6790\uff0c\u5b58\u50a8\u90fd\u5728spider</p> <p>\u4e00\u4e2a\u7b80\u6613\u7684\u6d41\u7a0b\u56fe\uff1a</p> <p></p> <ol> <li> <p>\u4ecestart_requests\u521d\u59cb\u5316\u5165\u53e3url\uff0c\u628a\u5c01\u88c5\u597d\u7684request \u6dfb\u52a0\u5230\u722c\u866b\u961f\u5217\u4e2d\u3002</p> </li> <li> <p>\u722c\u866b\u5f00\u59cb\u540e\u4ecescheduler\u83b7\u53d6request\uff0c\u5904\u7406\u722c\u866b\u4efb\u52a1\u3002</p> </li> <li> <p>\u5f53scheduler\u7684\u961f\u5217\u4e3a\u7a7a\u65f6\uff0c\u722c\u866b\u7ed3\u675f\u3002</p> </li> </ol>"},{"location":"Started/2.installation/","title":"2. \u5b89\u88c5","text":""},{"location":"Started/2.installation/#_1","title":"\u5b89\u88c5","text":"<pre><code># For Linux &amp; Mac\npip install -U hoopa[uvloop]\n\n# For Windows\npip install -U hoopa\n</code></pre>"},{"location":"Started/3.start/","title":"\u521b\u5efa\u722c\u866b","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u5de5\u5177\u5feb\u901f\u521b\u5efa\u722c\u866b</p>"},{"location":"Started/3.start/#_2","title":"\u521b\u5efa\u722c\u866b","text":"<pre><code>hoopa create -s demo\n</code></pre> <ul> <li>-s \u8868\u793a\u521b\u5efa\u7684\u662f\u5355\u6587\u4ef6\u722c\u866b</li> </ul> <p>\u53e6\u5916\u53ef\u9009\u53c2\u6570\u6709-f(--full)\uff0c\u53ef\u4ee5\u521b\u5efa\u65b9\u6cd5\u7684\u6bd4\u8f83\u9f50\u5168\u7684\u722c\u866b</p> <pre><code>hoopa create -s demo2 -f\n</code></pre> <p>\u521b\u5efa\u722c\u866b\u9879\u76ee</p> <pre><code>hoopa create -p demoProject\n</code></pre> <p>\u4f8b\u5b50\uff1a<code>hoopa create -s demo -f</code></p> <p>\u7136\u540e\u6dfb\u52a0\u5f00\u59cburl\uff1a \"https://httpbin.org/get\"</p> <pre><code>import hoopa\nfrom hoopa import Spider\nfrom hoopa import Item\n\n\nclass DataItem(Item):\n    pass\n\n\nclass CommonMiddleware:\n    def process_request(self, request, spider_ins):\n        pass\n\n    def process_response(self, request, response, spider_ins):\n        pass\n\n\nclass Demo(Spider):\n    name = \"demo\"\n    middlewares = [CommonMiddleware]\n\n    def start_requests(self):\n        yield hoopa.Request(url=\"\", callback=self.parse)\n\n    def parse(self, request, response):\n        print(response)\n\n    def process_item(self, item_list: list):\n        for item in item_list:\n            print(item)\n\n\nif __name__ == \"__main__\":\n    Demo.start()\n</code></pre>"},{"location":"Started/3.start/#_3","title":"\u8fd0\u884c\u722c\u866b","text":"<pre><code>python demo.py\n</code></pre>"},{"location":"Started/3.start/#_4","title":"\u91cd\u5199\u521d\u59cb\u5316","text":"<pre><code>def start_requests(self):\n    yield Request(url=\"https://httpbin.org/json\", callback=self.parse)\n</code></pre>"},{"location":"Started/3.start/#item","title":"\u6dfb\u52a0Item","text":"<pre><code>class DataItem(Item):\n    title: str\n    type: str\n</code></pre>"},{"location":"Started/3.start/#_5","title":"\u5904\u7406\u54cd\u5e94\uff0c\u89e3\u6790","text":"<pre><code>async def parse_json(self, request, response):\n    data = response.json()\n    slides = data[\"slideshow\"][\"slides\"]\n    for slide in slides:\n        data_item = DataItem()\n        data_item.title = slide[\"title\"]\n        data_item.type = slide[\"type\"]\n        yield data_item\n</code></pre>"},{"location":"Started/3.start/#_6","title":"\u4f7f\u7528\u4e2d\u95f4\u4ef6","text":"<pre><code>class CommonMiddleware:\n    def process_request(self, request, spider_ins):\n        request.timeout = 3\n\n    def process_response(self, request, response, spider_ins):\n        pass\n</code></pre>"},{"location":"Started/3.start/#_7","title":"\u6570\u636e\u5b58\u50a8","text":"<p>\u8fd9\u91cc\u53ea\u6253\u5370</p> <pre><code>async def process_item(self, item_list: list):\n    for item in item_list:\n        print(item)\n</code></pre>"},{"location":"Started/3.start/#_8","title":"\u5b8c\u6574\u4ee3\u7801","text":"<pre><code># -*- coding: utf-8 -*-\n\nfrom hoopa import Spider, Request\nfrom hoopa import Item\nfrom hoopa import Middleware\n\n\nclass DataItem(Item):\n    title: str\n    type: str\n\n\nclass CommonMiddleware:\n    def process_request(self, request, spider_ins):\n        request.timeout = 3\n\n    def process_response(self, request, response, spider_ins):\n        pass\n\n\nclass Demo(Spider):\n    name = \"demo\"\n    start_urls = [\"https://httpbin.org/get\"]\n    middlewares = [CommonMiddleware]\n\n    async def start_requests(self):\n        yield Request(url=\"https://httpbin.org/json\", callback=self.parse_json)\n\n    async def parse_json(self, request, response):\n        data = response.json()\n        slides = data[\"slideshow\"][\"slides\"]\n        for slide in slides:\n            data_item = DataItem()\n            data_item.title = slide[\"title\"]\n            data_item.type = slide[\"type\"]\n            yield data_item\n\n    async def process_item(self, item_list: list):\n        for item in item_list:\n            print(item)\n\n\nif __name__ == \"__main__\":\n    Demo.start()\n</code></pre>"},{"location":"basicConcepts/1.request/","title":"Request","text":"<p><code>Request</code>\u662f\u5bf9\u8bf7\u6c42\u53c2\u6570\u7684\u5c01\u88c5\uff0c\u4e3b\u8981\u662f\u7ed9downloader\u4e0b\u8f7d\u5668\u7684\u4f7f\u7528</p>"},{"location":"basicConcepts/1.request/#_1","title":"\u4e3b\u8981\u53c2\u6570","text":"<ul> <li>url\uff1a\u8bf7\u6c42\u7684\u8d44\u6e90\u94fe\u63a5</li> <li>method\uff1a\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c<code>get</code>\u6216\u8005<code>post</code>\uff0c\u9ed8\u8ba4<code>get</code></li> <li>headers\uff1a\u8bf7\u6c42\u5934</li> <li>callback\uff1a\u652f\u6301\u4e24\u79cd\u65b9\u5f0f\u4f20\u5165\uff0c\u53ef\u4ee5\u662f\u51fd\u6570\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u51fd\u6570\uff0c\u6700\u7ec8\u5b58\u50a8\u7684\u662f\u51fd\u6570\u540d\u79f0\u5b57\u7b26\u4e32</li> <li>meta\uff1a\u8de8\u8bf7\u6c42\u4f20\u9012\u6570\u636e</li> <li>request_config\uff1a\u8bf7\u6c42\u914d\u7f6e</li> <li>params: params\u53c2\u6570</li> <li>data: post\u8bf7\u6c42data\u53c2\u6570</li> <li>json: post\u8bf7\u6c42json\u53c2\u6570</li> <li>dont_filter\uff1a\u662f\u5426\u53bb\u91cd\uff0c\u9ed8\u8ba4\u662f\u53bb\u91cd\uff0c\u5982\u679c\u4e0d\u9700\u8981\u53bb\u91cd\u53ef\u4ee5\u8bbe\u7f6e\u4e3aFalse</li> <li>priority\uff1a \u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u8d8a\u5927\uff0c\u8bf7\u6c42\u8d8a\u4f18\u5148</li> <li>session\uff1ahttp\u8bf7\u6c42session</li> <li>client_kwargs\uff1a\u4f1a\u8bdd\u53c2\u6570\uff0c\u4f8b\u5982</li> <li>http_kwargs\uff1a\u8bf7\u6c42\u7684\u5176\u4ed6\u53c2\u6570</li> </ul> <p>\u5176\u4e2dsession\u4e0d\u8fdb\u884c\u5e8f\u5217\u5316\u5b58\u50a8\u5230\u961f\u5217\u4e2d\uff0c\u4e5f\u5c31\u662f\u521d\u59cb\u5316\u65f6\u8bbe\u7f6e\u4e5f\u662f\u65e0\u6548\u7684\uff0c\u4f1a\u88ab\u629b\u5f03\u3002 \u53ea\u6709\u4ece\u722c\u866b\u961f\u5217\u53d6\u51fa\u540e\uff0c\u8fdb\u884c\u8bbe\u7f6e\u624d\u6709\u6548\uff0c\u4f8b\u5982\u5728\u4e2d\u95f4\u4ef6\u548c\u91cd\u8bd5\u56de\u8c03\u4e2d\u8bbe\u7f6esession\u3002</p> <p>\u53e6\u5916\u5176\u4ed6\u8bf7\u6c42\u7684\u53c2\u6570\u76f4\u63a5\u4f20\u5373\u53ef</p>"},{"location":"basicConcepts/1.request/#_2","title":"\u5e8f\u5217\u5316\u95ee\u9898","text":"<p>\u9ed8\u8ba4\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u662fujson\uff0c\u8fdb\u884c\u5b58\u50a8\u7684\u662fstr\uff0c\u4f46\u662f\u5f53request\u53c2\u6570\u5b58\u5728\u4e00\u4e9b\u7279\u6b8a\u7b26\u53f7\u65f6\uff0c\u4f7f\u7528redis\u961f\u5217\u4f1a\u51fa\u73b0\u9519\u8bef\u3002 \u6b64\u65f6\u53ef\u4ee5\u9009\u62e9pickle\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u53e6\u5916\u4f7f\u7528pickle\u4e5f\u53ef\u4ee5\u8282\u7701\u5185\u5b58\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e SERIALIZATION=\"pickle\"</p>"},{"location":"basicConcepts/1.request/#_3","title":"\u53bb\u91cd\u6307\u7eb9","text":"<p>\u56e0\u4e3a\u6709post\u65b9\u6cd5\uff0c\u6240\u4ee5\u4e0d\u80fd\u7b80\u5355\u628aurl\u53bb\u91cd\uff0c\u53bb\u91cd\u6307\u7eb9\u7684\u751f\u6210\uff0c\u4e3b\u8981\u662f\u65b9\u6cd5\u7c7b\u578b\uff08get/post\uff09+url(\u5305\u542bquery string)+\u8bf7\u6c42\u4f53data+\u8bf7\u6c42\u4f53json</p> <pre><code>def request_fingerprint(request):\n    fp = hashlib.md5()\n    fp.update(to_bytes(request.method))\n    fp.update(to_bytes(request.request_url))\n    fp.update(to_bytes(str(request.data)) or b'')\n    fp.update(to_bytes(str(request.json)) or b'')\n\n    return fp.hexdigest()\n</code></pre>"},{"location":"basicConcepts/1.request/#_4","title":"\u4f8b\u5b50","text":"<pre><code>request = Request(url=\"https://httpbin.org/get\", callback=\"parse\", timeout=5)\nrequest.proxy = \"http://127.0.0.1:8888\"\nrequest.timeout = 3\nrequest.set(\"verify\", False)\nprint(request.http_kwargs)\n</code></pre>"},{"location":"basicConcepts/2.response/","title":"Response","text":"<p><code>Response</code>\u662f\u5bf9http Response\u7684\u5c01\u88c5\uff0c\u7531\u4e0b\u8f7d\u5668\u8fd4\u56de</p>"},{"location":"basicConcepts/2.response/#_1","title":"\u4e3b\u8981\u53c2\u6570","text":"<ul> <li>url\uff1a\u8bf7\u6c42\u7684url</li> <li>body\uff1a\u54cd\u5e94\u4f53</li> <li>status\uff1a\u54cd\u5e94\u72b6\u6001\u7801</li> <li>headers\uff1a\u54cd\u5e94\u7684headers</li> <li>cookies\uff1a\u54cd\u5e94\u7684cookies</li> <li>history\uff1a\u54cd\u5e94\u7684history</li> <li>encoding\uff1aencoding</li> <li>ok: \u8bf7\u6c42\u72b6\u6001</li> <li>error_type\uff1a \u9519\u8bef\u7c7b\u578b</li> <li>debug_msg\uff1a\u9519\u8bef\u65e5\u5fd7</li> </ul>"},{"location":"basicConcepts/3.downloader/","title":"Downloader","text":"<p>Downloader\u662f\u4e0b\u8f7d\u5668\uff0c\u7528\u4e8e\u7f51\u7edc\u8bf7\u6c42 \u4e0b\u8f7d\u5668\u5df2\u5b9e\u73b0\u7684\u6709aiohttp\u3001requests\u548chttpx\uff0c \u9ed8\u8ba4\u4f7f\u7528aiohttp</p> <ol> <li>\u53ef\u4ee5\u5728spider\u8bbe\u7f6e</li> </ol> <pre><code>from hoopa.settings import const\n# downloader_cls = const.AiohttpDownloader\n# \u8bbe\u7f6e\u4e3ahttpx\n# downloader_cls = const.HttpxDownloader\ndownloader_cls = const.RequestsDownloader\n</code></pre> <ol> <li>\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u8bbe\u7f6e</li> </ol> <pre><code>from hoopa.settings import const\nDOWNLOADER_CLS = const.HttpxDownloader\n</code></pre> <p>const.HttpxDownloader\u548cconst.AiohttpDownloader\u53ea\u662f\u5e38\u91cf\uff0c \"hoopa.downloader.HttpxDownloader\"\u548c\"hoopa.downloader.AiohttpDownloader\"\uff0c\u586b\u5199\u8fd9\u4e24\u4e2a\u4e5f\u662f\u53ef\u4ee5\u7684</p>"},{"location":"basicConcepts/3.downloader/#_1","title":"\u4e3b\u8981\u65b9\u6cd5\uff1a","text":"<ul> <li>fetch: \u8bf7\u6c42\u7f51\u9875\u8d44\u6e90</li> <li>async_fetch: \u8bf7\u6c42\u7f51\u9875\u8d44\u6e90, \u5f02\u6b65</li> </ul>"},{"location":"basicConcepts/3.downloader/#_2","title":"\u4e3b\u8981\u53c2\u6570","text":"<ul> <li>request: Request\u5bf9\u8c61\uff0c\u5177\u4f53\u770bRequest\u7684\u6587\u6863</li> </ul>"},{"location":"basicConcepts/3.downloader/#_3","title":"\u8fd4\u56de","text":"<ul> <li>response\uff1aResponse\u5bf9\u8c61\uff0c\u5177\u4f53\u770bResponse\u7684\u6587\u6863</li> </ul>"},{"location":"basicConcepts/3.downloader/#session","title":"session\u8bf4\u660e","text":"<p>\u4e0b\u8f7d\u5668\u9ed8\u8ba4\u4f7f\u7528\u5168\u5c40session \u5982\u679c\u6709\u6307\u5b9asession\uff0c\u8bf7\u8bbe\u7f6e\u53c2\u6570Request.session \u5982\u679c\u8bf7\u6c42\u60f3\u5355\u72ec\u521b\u5efasession\uff0c\u8bf7\u8bbe\u7f6e\u53c2\u6570Request.client_kwargs</p>"},{"location":"basicConcepts/3.downloader/#_4","title":"\u4f7f\u7528","text":"<p>\u6846\u67b6\u91cc\u9762\u7684\u4e0b\u8f7d\u5668\u662f\u53ef\u4ee5\u8c03\u7528\u7684\uff0c\u4f8b\u5982\u5728parse\u8c03\u7528\uff1a</p> <p>\u540c\u6b65</p> <pre><code>def parse(self, request, response):\n    resp = self.downloader.fetch((hoopa.Request(url=\"https://httpbin.org/get\")))\n    print(resp.text)\n</code></pre> <p>\u5f02\u6b65</p> <pre><code>async def parse(self, request, response):\n    resp = await self.downloader.async_fetch((hoopa.Request(url=\"https://httpbin.org/get\")))\n    print(resp.text)\n</code></pre> <p>\u5728\u4e2d\u95f4\u4ef6\u4f7f\u7528\uff1a</p> <pre><code># \u540c\u6b65\nclass DemoMiddleware:\n    def process_request(self, request, spider_ins):\n        resp = spider_ins.downloader.fetch((hoopa.Request(url=\"https://httpbin.org/get\")))\n</code></pre> <pre><code># \u5f02\u6b65\nclass DemoMiddleware:\n    async def process_request(self, request, spider_ins):\n        resp = await spider_ins.downloader.fetch((hoopa.Request(url=\"https://httpbin.org/get\")))\n</code></pre> <p>\u53e6\u5916\uff0c\u60f3\u8981\u5728\u89e3\u6790\u51fd\u6570\u6216\u8005\u4e2d\u95f4\u4ef6\u76f4\u63a5\u4f7f\u7528requets\uff0ctime.sleep\u7b49\u4e5f\u662f\u53ef\u4ee5\u7684\uff0c\u4e0d\u4f1a\u963b\u585e</p>"},{"location":"basicConcepts/3.downloader/#_5","title":"\u62d3\u5c55","text":"<p>\u9ed8\u8ba4\u652f\u6301aiohttp\u548chttpx\uff0c\u53ef\u662f\u81ea\u5df1\u7ee7\u627fDownloader\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u4e0b\u8f7d\u5668\uff0c\u4f8b\u5982pyppeteer, playwright\u7b49 \u53ea\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u4fee\u6539'DOWNLOADER_CLS'\u6216\u8005\u5728spider\u91cc\u9762\u8bbe\u7f6e\uff0c\u4f8b\u5982\uff1a</p> <pre><code>DOWNLOADER_CLS = \"hoopa.downloader.AiohttpDownloader\"\n</code></pre>"},{"location":"basicConcepts/4.item/","title":"Item","text":"<p>item\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u662f\u4e00\u4e2a\u666e\u901a\u6570\u636e\u7c7b\uff0c\u6570\u636e\u7c7b\u8981\u4e48\u8981\u7ee7\u627fItem\uff0c\u6216\u8005\u76f4\u63a5\u4f7f\u7528Item</p> <p>\u4e0d\u540c\u7684Item\u662f\u6839\u636ename\u533a\u522b\u7684\uff0c\u5728\u5b58\u50a8\u7684\u7684\u65f6\u5019\u5224\u65adname\u5c31\u884c\u4e86 \u9ed8\u8ba4\u662f\u7c7b\u540d\uff0c\u7ee7\u627f\u4e86Item\u7684\u7c7b\u662f\u5b50\u7c7b\u7684\u7c7b\u540d</p> <p>\u4e5f\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e, \u65b0\u5efa\u5b9e\u4f8b\u7684\u65f6\u5019\u4f20name\u53c2\u6570\u5373\u53ef</p> <pre><code>import hoopa\n\n\nclass DataItem(hoopa.Item):\n    pass\n\n# name: DateItem\ndata_item = DataItem()\n\n# name: DetailItem\ndata_item2 = DataItem(\"DetailItem\")\n\n# name: Item\nitem = hoopa.Item()\n\n# name: MyItem\nitem2 = hoopa.Item(\"MyItem\")\n</code></pre>"},{"location":"basicConcepts/4.item/#_1","title":"\u4f7f\u7528","text":"<pre><code>import hoopa\nclass DataItem(hoopa.Item):\n    pass\n\nasync def parse(self, request, response):\n    data_item = DataItem()\n    data_item.url = \"xxxx\"\n    data_item.title = \"xxxx\"\n    yield data_item\n\nasync def parse2(self, request, response):\n    # \u76f4\u63a5\u4f7f\u7528Item\n    item = hoopa.Item()\n    item.url = \"xxxx\"\n    item.title = \"xxxx\"\n    yield item    \n\nasync def parse3(self, request, response):\n    # \u5982\u679c\u591a\u4e2aItem\uff0c\u8bbe\u7f6ename\u533a\u522b\n    item = hoopa.Item(\"MyItem\")\n    item.url = \"xxxx\"\n    item.title = \"xxxx\"\n    yield item\n\n\n\n</code></pre>"},{"location":"basicConcepts/5.spider/","title":"Spider","text":"<p>\u722c\u866b\u7684\u6838\u5fc3\uff0c\u4e5f\u662f\u722c\u866b\u7684\u5165\u53e3\uff0cspider\u5c06\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u7ec4\u5408\u5230\u4e00\u8d77\u3002</p>"},{"location":"basicConcepts/5.spider/#_1","title":"\u4e3b\u8981\u53c2\u6570","text":"<p>Spider\u7684\u4e3b\u8981\u53c2\u6570\u662f\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5b50\u7c7b\u7ee7\u627fSpider\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u53c2\u6570\u914d\u7f6e\u722c\u866b</p> <ul> <li>name: \u722c\u866b\u540d\u79f0</li> <li>worker_numbers: \u6700\u5927\u534f\u7a0b\u6570</li> <li>download_delay: \u722c\u866b\u8bf7\u6c42\u95f4\u9694</li> <li>pending_threshold: pending\u8d85\u65f6\u65f6\u95f4</li> <li>run_forever: \u4efb\u52a1\u5b8c\u6210\u4e0d\u505c\u6b62, \u9ed8\u8ba4False</li> <li>queue_cls: \u4efb\u52a1\u961f\u5217\u8def\u5f84\uff0c\u9ed8\u8ba4\uff1aconst.MemoryQueue(hoopa.queues.MemoryQueue)</li> <li>clean_queue: \u6e05\u7a7a\u4efb\u52a1\u961f\u5217\uff0c\u9ed8\u8ba4False</li> <li>priority: \u6307\u5b9a\u961f\u5217\u4f18\u5148\u7ea7\uff08int\uff0clist[int]\uff09\uff0credis\u4f18\u5148\u961f\u5217\u6709\u6548</li> <li>downloader_cls: \u4e0b\u8f7d\u5668\u8def\u5f84\uff0c\u9ed8\u8ba4\uff1aconst.AiohttpDownloader(hoopa.downloader.AiohttpDownloader)</li> <li>middlewares: \u4e0b\u8f7d\u4e2d\u95f4\u4ef6</li> <li>dupefilter_cls: \u53bb\u91cd\u5668\u8def\u5f84\uff0c\u4e0d\u914d\u7f6e\u7684\u8bdd\u6839\u636equeue_cls\u6765\u51b3\u5b9a, MemoryQueue\u548cRabbitMQQueue\u4f7f\u7528MemoryDupeFilter\uff0cRedisQueue\u4f7f\u7528RedisDupeFilter</li> <li>clean_dupefilter: \u6e05\u7a7a\u53bb\u91cd\u5668\uff0c\u9ed8\u8ba4\u7b49\u4e8eclean_queue</li> <li>dupefilter_setting: \u53bb\u91cd\u5668\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u7b49\u4e8eredis_setting</li> <li>redis_setting: redis\u8fde\u63a5\u914d\u7f6e\uff0c\u53ef\u4ee5\u662f\u5b57\u5178\uff0c\u4e5f\u53ef\u4ee5\u662furi</li> <li>mq_uri: mq uri\u94fe\u63a5</li> <li>mq_maxsize: mq\u8fde\u63a5\u6c60\u5927\u5c0f</li> <li>mq_api_port: mq web api\u7aef\u53e3</li> <li>serialization: \u5e8f\u5217\u5316\u6a21\u5757\uff0c\u9ed8\u8ba4ujson\uff0c\u53ef\u9009pickle</li> <li>log_level\uff1a \u65e5\u5fd7\u7ea7\u522b\uff0c\u9ed8\u8ba4INFO</li> <li>log_write_file\uff1a \u65e5\u5fd7\u662f\u5426\u5199\u5165\u6587\u4ef6\uff0c\u9ed8\u8ba4\u5426</li> <li>settings_path\uff1a \u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u9ed8\u8ba4\"config.setting\"\u3002\u53ef\u4f7f\u7528\u5168\u8def\u5f84\uff0c\u5982\uff1a\"/root/setting.py\"\uff08\u914d\u7f6e\u6587\u4ef6\u4e0d\u53ef\u914d\u7f6e\uff09</li> <li>start_urls\uff1a \u8d77\u59cburl\u5217\u8868\uff0c\u9664\u4e86url\u5176\u5b83request\u53c2\u6570\u5168\u90e8\u9ed8\u8ba4\uff0ccallback\u9ed8\u8ba4\u4e3aparse\uff08\u914d\u7f6e\u6587\u4ef6\u4e0d\u53ef\u914d\u7f6e\uff09</li> </ul>"},{"location":"basicConcepts/5.spider/#_2","title":"\u4e3b\u8981\u65b9\u6cd5","text":"<ul> <li>start</li> <li>\u722c\u866b\u542f\u52a8\u5165\u53e3</li> <li>\u4e3b\u8981\u53c2\u6570\uff1a<ul> <li>before_start\uff1a\u722c\u866b\u5f00\u59cb\u524d\u7684\u94a9\u5b50\u51fd\u6570</li> <li>after_stop\uff1a\u722c\u866b\u7ed3\u675f\u540e\u7684\u94a9\u5b50\u51fd\u6570</li> <li>middleware\uff1a\u4e2d\u95f4\u4ef6\u7c7b\uff0c<code>Middleware()</code>\u5b9e\u4f8b\u5217\u8868</li> <li>loop\uff1a\u4e8b\u4ef6\u5faa\u73af</li> </ul> </li> <li>parse:</li> <li>\u89e3\u6790\u51fd\u6570\uff0c\u89e3\u6790\u8d77\u59cburl\uff0c\u5982\u679c\u89e3\u6790\u8d77\u59cburl\uff0c\u5b50\u7c7b\u8981\u5b9e\u73b0\u8fd9\u4e2a\u51fd\u6570</li> <li> <p>\u4e3b\u8981\u53c2\u6570\uff1a</p> <ul> <li>self: \u5f53\u524d\u5b9e\u4f8b</li> <li>request: \u722c\u866b\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u7684request</li> <li>response: \u4e0b\u8f7d\u5668\u8fd4\u56de\u7684response</li> </ul> </li> <li> <p>init: \u8d1f\u8d23\u5f02\u6b65\u51fd\u6570\u7684\u521d\u59cb\u5316\uff0c\u5b50\u7c7b\u6839\u636e\u9700\u8981\u5b9e\u73b0</p> </li> <li> <p>start_requests: \u7528\u4e8e\u521d\u59cb\u5316url, \u5982\u679c\u586b\u5199start_urls\u9ed8\u8ba4\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c\u91cd\u5199\u8fd9\u4e2a\u51fd\u6570\uff0cstart_urls\u4f1a\u5931\u6548</p> </li> <li> <p>process_item: </p> </li> <li>\u5904\u7406Item\u3002\u4f7f\u7528redis\u961f\u5217\u4f1a\u9ed8\u8ba4\u5b58\u50a8\u5230redis\uff08\u53ef\u91cd\u5199\uff09\uff0c\u5176\u5b83\u60c5\u51b5\u9700\u8981\u91cd\u5199\u3002</li> <li>\u4e3b\u8981\u53c2\u6570\uff1a<ul> <li>item_list\uff1a\u89e3\u6790\u51fd\u6570\u8fd4\u56de\u7684\u6240\u6709Item\u7ec4\u6210\u7684list</li> </ul> </li> </ul>"},{"location":"basicConcepts/5.spider/#_3","title":"\u4f7f\u7528","text":"<pre><code>import hoopa\nfrom hoopa.settings import const\n\n\nclass DataItem(hoopa.Item):\n    title: str\n    type: str\n\n\nclass DemoSpider(hoopa.Spider):\n    name = \"demo\"\n    start_urls = [\"http://httpbin.org/json\"]\n    downloader_cls = const.AiohttpDownloader\n\n    async def parse(self, request, response):\n        data = response.json()\n        slides = data[\"slideshow\"][\"slides\"]\n        for slide in slides:\n            data_item = DataItem()\n            data_item.title = slide[\"title\"]\n            data_item.type = slide[\"type\"]\n            yield data_item\n\n    async def process_item(self, item_list: list):\n        for item in item_list:\n            print(item)\n\n\nif __name__ == \"__main__\":\n    DemoSpider.start()\n</code></pre>"},{"location":"basicConcepts/6.middleware/","title":"Middleware","text":"<p>\u4e2d\u95f4\u4ef6\u53ea\u6709\u4e0b\u8f7d\u4e2d\u95f4\u4ef6\uff0c\u4e3b\u8981\u662f\u5bf9\u722c\u866b\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5904\u7406\u3002</p>"},{"location":"basicConcepts/6.middleware/#_1","title":"\u8bf4\u660e","text":"<p>\u4e2d\u95f4\u4ef6\u53ea\u6709\u4e24\u4e2a\u53ea\u6709\u4e24\u4e2a\u65b9\u6cd5<code>process_request</code>\u548c<code>process_response</code></p> <ul> <li>process_request</li> <li>\u53c2\u6570: request, spider_ins(spider\u5b9e\u4f8b)</li> <li>\u8fd4\u56de\u503c: Response, Request, None</li> <li> <p>\u8bf4\u660e\uff1a \u5f53\u8fd4\u56de\u503c\u4e0d\u4e3aNone\u7684\u65f6\u5019\u4e0d\u518d\u6267\u884c\u540e\u9762\u7684\u4e2d\u95f4\u4ef6\u548c\u4e0b\u8f7d\u5668\uff0c\u76f4\u63a5\u8fd4\u56de</p> </li> <li> <p>process_response</p> </li> <li>\u53c2\u6570: request, response, spider_ins(spider\u5b9e\u4f8b)</li> <li>\u8fd4\u56de\u503c: Response, Request, None</li> <li>\u8bf4\u660e\uff1a \u5f53\u8fd4\u56de\u503c\u4e0d\u4e3aNone\u7684\u65f6\u5019\u4e0d\u518d\u6267\u884c\u540e\u9762\u7684\u4e2d\u95f4\u4ef6\uff0c\u76f4\u63a5\u8fd4\u56de</li> </ul>"},{"location":"basicConcepts/6.middleware/#_2","title":"\u4f7f\u7528","text":"<pre><code>class DemoMiddleware:\n    def process_request(self, request, spider_ins):\n        print(f\"{request} \u4e2d\u95f4\u4ef6 \u6bcf\u6b21\u8bf7\u6c42\u524d\u8c03\u7528\")\n\n    def process_response(self, request, response, spider_ins):\n        print(f\"{response} \u4e2d\u95f4\u4ef6 \u6bcf\u6b21\u8bf7\u6c42\u540e\u8c03\u7528\")\n\n</code></pre>"},{"location":"basicConcepts/7.queue/","title":"Queue","text":"<p>\u722c\u866b\u961f\u5217\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u7684\u6709\uff1a\u5185\u5b58\u3001redis\u3001rabbitmq\u4e09\u79cd\u961f\u5217\uff0c\u53e6\u5916\u5982\u679c\u6709\u9700\u6c42\u53ef\u4ee5\u81ea\u5b9a\u4e49\u961f\u5217</p> <p>\u5185\u5b58\u548crabbitmq\u9664\u4e86\u5b58\u50a8\uff0c\u5176\u4ed6\u7684\u57fa\u672c\u5dee\u4e0d\u591a\u3002rabbitmq\u961f\u5217\u8fd8\u4e0d\u5b8c\u5584</p> <p>redis\u5b9e\u73b0\u6bd4\u8f83\u591a\u7684\u529f\u80fd\u3002</p>"},{"location":"basicConcepts/7.queue/#_1","title":"\u4f7f\u7528","text":"<p>\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u5185\u5b58\u961f\u5217\uff0c\u5207\u6362\u6210redis\u961f\u5217\u8bbe\u7f6equeue_cls\u548credis_setting\uff0c\u5f53\u4f7f\u7528redis\u4f5c\u4e3a\u961f\u5217\u7684\u65f6\u5019\uff0c \u4fe1\u606f\u7edf\u8ba1\u548c\u53bb\u91cd\u9ed8\u8ba4redis</p> <pre><code>queue_cls = const.RedisQueue\n# setting\u53ef\u4ee5\u662furi\uff0c\u4e5f\u53ef\u4ee5\u662f\u914d\u7f6e\u5b57\u5178\n# redis_setting = \"redis://127.0.0.1:6379/0?encoding=utf-8\"\nredis_setting = {\n    'host': '127.0.0.1',\n    'port': 6379,\n    'db': 0,\n    'password': ''\n}\n</code></pre> <p>\u4f8b\u5b50\uff1a</p> <pre><code>import hoopa\nfrom hoopa.settings import const\n\n\nclass DataItem(hoopa.Item):\n    title: str\n    type: str\n\n\nclass RedisDemoSpider(hoopa.Spider):\n    name = \"redis_demo\"\n    start_urls = [\"http://httpbin.org/json\"]\n\n    # \u8bbe\u7f6e\u961f\u5217\u4e3aredis\n    queue_cls = const.RedisQueue\n    redis_setting = \"redis://127.0.0.1:6379/0?encoding=utf-8\"\n\n    async def parse(self, request, response):\n        data = response.json()\n        slides = data[\"slideshow\"][\"slides\"]\n        for slide in slides:\n            data_item = DataItem()\n            data_item.title = slide[\"title\"]\n            data_item.type = slide[\"type\"]\n            yield data_item\n\n\nif __name__ == \"__main__\":\n    RedisDemoSpider.start()\n\n</code></pre> <p>\u8fd0\u884c\u5b8c\u6210\u540e\uff0credis\u622a\u56fe\uff1a</p> <ul> <li> <p>DupeFilter: \u53bb\u91cd\u6307\u7eb9</p> </li> <li> <p>DataItem: \u6570\u636e</p> </li> <li> <p>Stats: \u7edf\u8ba1</p> </li> </ul> <p></p>"},{"location":"other/config/","title":"\u914d\u7f6e","text":""},{"location":"other/dupefilters/","title":"Dupefilters","text":"<p>\u53bb\u91cd\uff0c\u9ed8\u8ba4\u662f\u5185\u5b58\u53bb\u91cd\uff0c\u53bb\u91cd\u6307\u7eb9\u662fmd5</p> <p>\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4fee\u6539redis\u53bb\u91cd\uff08\u517c\u5bb9redis hash\u7684\u4e5f\u53ef\u4ee5\uff0c\u4f8b\u5982tendis\uff09</p> <pre><code>dupefilter_cls = const.RedisDupeFilter\ndupefilter_setting = \"redis://127.0.0.1:6379/0?encoding=utf-8\"\n</code></pre> <p>\u9ed8\u8ba4\u53bb\u91cd\u6ca1\u6709\u5b9e\u73b0\u5e03\u9686\u53bb\u91cd\uff0c\u53ef\u4ee5\u8fdb\u884c\u62d3\u5c55</p>"},{"location":"other/stats/","title":"Stats","text":"<p>\u7edf\u8ba1\uff0c\u9ed8\u8ba4\u662f\u4f7f\u7528\u5185\u5b58\u7684\uff0c\u5982\u679c\u4f7f\u7528\u9ed8\u8ba4\u7684redis\u961f\u5217\uff0c\u9ed8\u8ba4\u4f7f\u7528redis</p> <p>\u6839\u636e\u9700\u6c42\u4fee\u6539</p> <pre><code>stats_cls = const.RedisStatsCollector\n</code></pre> <p>\u914d\u7f6e\u4e3aredis_setting</p>"},{"location":"use/depth/","title":"\u9650\u5236\u6df1\u5ea6","text":""},{"location":"use/proxy/","title":"\u4ee3\u7406ip","text":"<p>\u4ee3\u7406ip\u662f\u5728\u4e2d\u95f4\u4ef6\u8bbe\u7f6e\u7684\uff0c\u56e0\u4e3a\u6709\u4e0d\u540c\u7684HTTP\u5e93\uff0c\u6240\u4ee5\u8bbe\u7f6e\u4ee3\u7406\u7684\u65f6\u5019\u8981\u6839\u636e\u81ea\u5df1\u4f7f\u7528\u7684\u4e0b\u8f7d\u5668\u6765\u8bbe\u7f6e</p> <pre><code>class ProxyMiddleware:\n    def process_request(self, request, spider_ins):\n        # \u5224\u65ad\u4e0b\u8f7d\u5668\n        if spider_ins.downloader_cls == const.AiohttpDownloader:\n            request.proxy = \"http://127.0.0.1:7890\"\n        else:\n            request.proxies = {'https': \"http://127.0.0.1:7890\", 'http': \"http://127.0.0.1:7890\"}\n</code></pre> <p>\u5982\u679cip\u662f\u901a\u8fc7\u63a5\u53e3\u83b7\u53d6\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528http\u8bf7\u6c42\u83b7\u53d6\u3002</p> <pre><code>class ProxyMiddleware:\n    def process_request(self, request, spider_ins):\n        # \u5224\u65ad\u4e0b\u8f7d\u5668\n        if spider_ins.downloader_cls == const.AiohttpDownloader:\n            request.proxy = \"http://127.0.0.1:7890\"\n        else:\n            request.proxies = {'https': \"http://127.0.0.1:7890\", 'http': \"http://127.0.0.1:7890\"}\n</code></pre>"},{"location":"use/retry/","title":"\u91cd\u8bd5","text":""},{"location":"use/retry/#_2","title":"\u9ed8\u8ba4\u7684\u91cd\u8bd5","text":"<p>\u9ed8\u8ba4\u7684\u91cd\u8bd5\u7531Request\u7684request_config\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u662f\u91cd\u8bd5\u4e09\u6b21\uff0c\u9ed8\u8ba4\u4e0d\u4f11\u7720\uff0c\u91cd\u8bd5\u4e4b\u524d\u53ef\u4ee5\u8c03\u7528\u81ea\u5b9a\u4e49\u65b9\u6cd5</p> <p>\u9ed8\u8ba4\u7684\u91cd\u8bd5\u4e0d\u653e\u56de\u961f\u5217\uff0c\u76f4\u63a5\u4f1a\u8fdb\u884c\u91cd\u8bd5\uff0c\u4f1a\u4f7f\u7528\u4e2d\u95f4\u4ef6</p> <p>\u5982\u679c\u4e0d\u60f3\u91cd\u8bd5\uff0c\u53ef\u4ee5\u5728\u4e2d\u95f4\u4ef6\u8bbe\u7f6erequest\u7684request_config</p> <pre><code>REQUEST_CONFIG = {\n    \"RETRIES\": 3,  # \u91cd\u8bd5\u6b21\u6570\n    \"RETRY_DELAY\": 0,  # \u91cd\u8bd5\u95f4\u9694\n    \"RETRY_FUNC\": typing.Callable,  # \u91cd\u8bd5\u4e4b\u524d\u7684\u51fd\u6570\u8c03\u7528\n}\n</code></pre>"},{"location":"use/retry/#_3","title":"\u4e2d\u95f4\u5b9e\u73b0\u7684\u91cd\u8bd5","text":"<p>\u5982\u679c\u4e0d\u60f3\u7528\u9ed8\u8ba4\u7684\u91cd\u8bd5\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6\u7684\u91cd\u8bd5\uff0c\u91cd\u8bd5\u4f1a\u653e\u56de\u961f\u5217\uff0c\u91cd\u8bd5\u6b21\u6570\u53ef\u4ee5\u5728meta\u8bbe\u7f6e</p>"}]}